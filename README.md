# Accent

Accent is a smart picture frame with a pop of color and noÂ cables. Read more about it [on Medium](https://medium.com/@maxbraun/meet-accent-352cfa95813a).

[![Accent](accent.gif)](https://medium.com/@maxbraun/meet-accent-352cfa95813a)

## Server

The Accent server is built on [Google App Engine](https://cloud.google.com/appengine/) using the [Python 3 runtime in the standard environment](https://cloud.google.com/appengine/docs/standard/python3/runtime).

The database backend uses [Cloud Firestore](https://firebase.google.com/products/firestore/). To populate it after [setting up](https://firebase.google.com/docs/firestore/quickstart):

1. Obtain API keys for [Google Maps](https://cloud.google.com/maps-platform/#get-started) and [Dark Sky](https://darksky.net/dev), then add them in the `api_keys` collection under `/api_keys/google_maps/api_key` and `/api_keys/dark_sky/api_key`.
2. User-specific data is stored in the `users` collection with each user identified by a key generated by the client to identify it. _This will eventually be populated by the [new user flow](https://github.com/maxbbraun/accent/blob/master/server/main.py#L100)._
   - `/users/<USER_KEY>/home` - The commute home address.
   - `/users/<USER_KEY>/work` - The commute work address.
   - `/users/<USER_KEY>/travel_mode` - The commute [travel mode](https://developers.google.com/maps/documentation/directions/intro#TravelModes).
   - `/users/<USER_KEY>/timezone` - The home [time zone](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones).
   - `/users/<USER_KEY>/schedule` - The content [schedule](https://github.com/maxbbraun/accent/blob/master/server/schedule.py#L23).
3. [Authenticate with the Google Calendar API](https://colab.research.google.com/drive/1mcgu_8cxxb-MMDKICr8oy9kFPSFPYlZ7#sandboxMode=true&scrollTo=ThqaE4cyA4R1) to create `g_calendar_secrets.json` and `g_calendar_credentials.json`, then save them to [`server`](server). _This will eventually be user-specific and populated by the [new user flow](https://github.com/maxbbraun/accent/blob/master/server/main.py#L100)._

To test and deploy the server:
1. [Install the Google Cloud SDK](https://cloud.google.com/sdk/docs/).
2. Run `cd server && python3 -m venv venv && . venv/bin/activate`.
3. Run `pip install -r requirements.txt`.
4. Run the server locally with `export GOOGLE_CLOUD_PROJECT=$(gcloud config get-value project) && python main.py`.
5. Test the local server with `?key=<USER_KEY>` and:
   - [/next](http://localhost:8080/next?key=<USER_KEY>) for the time in milliseconds until the next schedule entry.
   - [/epd](http://localhost:8080/epd?key=<USER_KEY>) for the currently scheduled 2-bit image used by the e-paper display.
   - [/png](http://localhost:8080/png?key=<USER_KEY>) for a PNG version of the currently scheduled image for easier debugging.
   - [/artwork](http://localhost:8080/artwork?key=<USER_KEY>) to bypass the schedule and get the artwork image directly.
   - [/city](http://localhost:8080/city?key=<USER_KEY>) to bypass the schedule and get the city image directly.
   - [/commute](http://localhost:8080/commute?key=<USER_KEY>) to bypass the schedule and get the commute image directly.
   - [/calendar](http://localhost:8080/calendar?key=<USER_KEY>) to bypass the schedule and get the calendar image directly.
6. Deploy the server with `gcloud app deploy`.

## Client

The Accent client uses the [Arduino toolchain](https://www.arduino.cc/en/Main/Software) for the [Waveshare ESP32 board](https://www.waveshare.com/wiki/E-Paper_ESP32_Driver_Board).

To push the client code to the ESP32:
1. Add a Wifi SSID and password to [`credentials.h`](client/credentials.h#L36).
2. Add the server URL to [`credentials.h`](client/credentials.h#L46).
3. Use the board information in [`client.ino`](client/client.ino#L9) to set up the environment.
4. Verify and upload the sketch.

## Frame

Files describing the Accent frame hardware include:
- A [Blender](https://www.blender.org/) project for simulating materials: [`frame.blend`](frame/frame.blend)
- A blueprint with basic dimensions: [`frame.pdf`](frame/frame.pdf)
- A [Shaper Origin](https://www.shapertools.com/) design: [`frame.svg`](frame/frame.svg)
- A [FreeCAD](https://www.freecadweb.org/) project: [`frame.FCStd`](frame/frame.FCStd)
- A G-code file for CNC milling: [`frame.gcode`](frame/frame.gcode)
- 3D models in STEP and STL formats: [`frame.step`](frame/frame.step) & [`frame.stl`](frame/frame.stl)

## License

Copyright 2019 Max Braun

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
